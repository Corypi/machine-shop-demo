<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Machine Shop Demo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="../Styles/main.css" />
  <link rel="preload" as="video" href="../Assets/Movie_001.mp4" type="video/mp4">
  <link rel="preload" as="video" href="../Assets/Movie_002.mp4" type="video/mp4">
</head>
<body>
  <!-- Header -->
  <header class="Header">
    <h1 class="HeaderTitle">Welcome to Our Machine Shop</h1>
    <p class="HeaderSubtitle">High-precision parts, modern capabilities.</p>
  </header>

  <!-- Progressive TabBar (built by TabBarController) -->
  <div id="TabBar" class="TabBar" role="tablist" aria-label="Sections" aria-hidden="true">
    <div id="TabBarTrack" class="TabBarTrack"></div>
  </div>

  <!-- Main content: Drawer stack -->
  <main class="Container" id="Top">
    <!-- HERO / Intro: video with Skip Intro -->
    <section class="Drawer Drawer--FixedHero" id="Intro" data-drawer>
      <h3
        class="DrawerTitle"
        data-drawer-summary
        tabindex="0"
        role="button"
        aria-expanded="false"
        aria-controls="Intro__content"
      >Intro</h3>

      <div class="DrawerContent DrawerContent--Fill" id="Intro__content" data-drawer-content>
        <div class="VideoWrapper">
          <video
            class="VideoFixed"
            src="../Assets/Movie_001.mp4"
            data-prime="true"
            preload="auto"
            muted
            autoplay
            playsinline
            webkit-playsinline
          ></video>

          <!-- Uses unified programmatic path that opens About, removes hero, then snaps reliably -->
          <!-- Intro drawer only  -->
<button
  class="SkipButton SkipButton--Overlay"
  onclick="window.SkipIntro && window.SkipIntro();">
  Skip Intro
</button>
        </div>
      </div>
    </section>

    <!-- About -->
    <section class="Drawer" id="About" data-drawer>
      <h3
        class="DrawerTitle"
        data-drawer-summary
        tabindex="0"
        role="button"
        aria-expanded="false"
        aria-controls="About__content"
      >About Us</h3>

      <div class="DrawerContent" id="About__content" data-drawer-content>
        <p>We machine complex parts with tight tolerances and consistent turnaround.</p>
        <p>ISO-style processes, modern CAM, and a quality-first culture.</p>
      </div>
    </section>

    <!-- Shop Tour -->
    <section class="Drawer Drawer--FixedShort" id="Tour" data-drawer>
  <h3 class="DrawerTitle" data-drawer-summary tabindex="0" role="button">Shop Tour</h3>
  <div class="DrawerContent DrawerContent--Fill" data-drawer-content>
    <div class="VideoWrapper">
      <video
        class="VideoFixed"
        src="../Assets/Movie_002.mp4"
        data-prime="true"
        preload="auto"
        muted
        playsinline
        webkit-playsinline
      ></video>
      <!-- Tour skip) -->
<button
  class="SkipButton SkipButton--Overlay"
  onclick="window.HandleSkipTour && window.HandleSkipTour();">
  Skip Tour
</button>
    </div>
  </div>
</section>

    <!-- Capabilities -->
    <section class="Drawer" id="Capabilities" data-drawer>
      <h3
        class="DrawerTitle"
        data-drawer-summary
        tabindex="0"
        role="button"
        aria-expanded="false"
        aria-controls="Capabilities__content"
      >Capabilities</h3>

      <div class="DrawerContent" id="Capabilities__content" data-drawer-content>
        <ul>
          <li>3-axis &amp; 5-axis milling, CNC turning</li>
          <li>Materials: 6061/7075, 304/316, 4140, brass, plastics</li>
          <li>Finishes: anodize II/III, passivate, bead blast</li>
          <li>Inspection: calibrated metrology, first-article docs</li>
        </ul>
      </div>
    </section>

    <!-- Contact -->
    <section class="Drawer" id="Contact" data-drawer>
      <h3
        class="DrawerTitle"
        data-drawer-summary
        tabindex="0"
        role="button"
        aria-expanded="false"
        aria-controls="Contact__content"
      >Contact</h3>

      <div class="DrawerContent" id="Contact__content" data-drawer-content>
        <p>Email: <a href="mailto:info@example.com">info@example.com</a></p>
        <p>Phone: 555-0100</p>
      </div>
    </section>
  </main>

  <!-- Footer -->
  <footer class="Footer">
    <small>© <span id="Year"></span> Acme Precision • Demo</small>
  </footer>

  <!-- Scripts (defer to avoid blocking paint) -->
  <script src="../Scripts/Utilities.js" defer></script>
  <script src="../Scripts/Drawers.js" defer></script>
  <script src="../Scripts/TabBar.js" defer></script>

  <!-- Left debug probe (kept for diagnostics) -->
<script>
(function(){
  "use strict";

  // Track the last opened drawer id; default to any drawer that's open on load.
  var targetId = null;

  document.addEventListener("drawer:opened", function(e){
    if (e && e.detail && e.detail.id){ targetId = e.detail.id; }
  });

  document.addEventListener("DOMContentLoaded", function(){
    var open = document.querySelector(".Drawer.Drawer--Open");
    if (open && open.id){ targetId = open.id; }
  });

  function ensureBox(){
    var box = document.getElementById("DebugProbe");
    if (!box){
      box = document.createElement("div");
      box.id = "DebugProbe";
      document.body.appendChild(box);
    }
    return box;
  }

  function rect(el){ return el ? el.getBoundingClientRect() : null; }
  function num(n){ return (typeof n === "number" && isFinite(n)) ? Math.round(n) : "—"; }

  function getBarBottom(){
    var bar = document.getElementById("TabBar");
    if (!bar) return 0;
    var r = bar.getBoundingClientRect();
    return Math.round(r.bottom || 0);
  }

  function probe(){
    var box = ensureBox();

    // If no explicit target yet, pick the first drawer element present.
    if (!targetId){
      var first = document.querySelector("[data-drawer]");
      if (first && first.id){ targetId = first.id; }
    }

    var drawer  = targetId ? document.getElementById(targetId) : null;
    var content = drawer ? drawer.querySelector("[data-drawer-content]") : null;
    var video   = drawer ? drawer.querySelector("video") : null;
    var button  = drawer ? drawer.querySelector(".SkipButton--Overlay") : null;
    var title   = drawer ? (drawer.querySelector("[data-drawer-summary]") || drawer) : null;

    var cr = rect(content);
    var vr = rect(video);
    var br = rect(button);
    var tr = rect(title);
    var barBtm = getBarBottom();

    var lines = [];

    lines.push("=== Left Probe ===");
    lines.push("drawer: " + (drawer ? drawer.id : "—"));

    // Title vs TabBar for snap verification
    if (tr){
      lines.push("title top: " + num(tr.top) + "px");
      lines.push("title vs bar: " + num(tr.top - barBtm) + "px");
      
    }

    // Content block metrics
    lines.push("content bottom: " + (cr ? num(cr.bottom) : "—"));
    lines.push("content height: " + (cr ? num(cr.height) : "—"));

    // Video metrics (only if present in this drawer)
    lines.push("video   bottom: " + (vr ? num(vr.bottom) : "—"));
    lines.push("video   height: " + (vr ? num(vr.height) : "—"));

    // Skip button metrics (only exists in Intro)
    lines.push("button  bottom: " + (br ? num(br.bottom) : "—"));

    // Drawer state
    var isOpen = !!(drawer && drawer.classList.contains("Drawer--Open"));
    
    lines.push("isOpen: " + isOpen);

    box.textContent = lines.join("\n");
  }

  // Re-run on layout-affecting events
  ["load","resize","orientationchange","scroll"].forEach(function(ev){
    window.addEventListener(ev, probe, { passive:true });
  });
  document.addEventListener("loadedmetadata", probe, true);
  document.addEventListener("transitionend", probe, true);
  document.addEventListener("drawer:opened", probe, true);
  document.addEventListener("drawer:closed", probe, true);

  // Keep it updating periodically as before
  setInterval(probe, 400);
})();
</script>

<!-- Right scroll probe + Blue push-down indicator (self-contained CSS) -->
<script>
(function(){
  var box, lastY = window.pageYOffset || document.documentElement.scrollTop || 0;
  var lastT = (performance.now ? performance.now() : Date.now());
  var indWrap, indInner;

  // --- Inject debug CSS once ---
  (function ensureDebugStyle(){
    if (document.getElementById("DebugPushIndicatorStyles")) return;
    var css = [
      "/* ===== Blue push-down indicator ===== */",
      "#ScrollPushIndicator{position:fixed;top:0;left:0;right:0;height:16px;overflow:hidden;z-index:99998;pointer-events:none;}",
      "#ScrollPushIndicatorInner{position:absolute;top:-10px;left:50%;transform:translate(-50%,0);font:700 16px/1 ui-monospace,SFMono-Regular,Menlo,Consolas,'Liberation Mono',monospace;color:#48b0ff;white-space:nowrap;text-rendering:geometricPrecision;-webkit-font-smoothing:antialiased;will-change:transform;}"
    ].join("");
    var style = document.createElement("style");
    style.id = "DebugPushIndicatorStyles";
    style.type = "text/css";
    style.appendChild(document.createTextNode(css));
    document.head.appendChild(style);
  })();

  // --- Blue push-down indicator elements ---
  function ensureIndicator(){
    if (!indWrap){
      indWrap = document.createElement("div");
      indWrap.id = "ScrollPushIndicator";
      indInner = document.createElement("div");
      indInner.id = "ScrollPushIndicatorInner";
      indInner.textContent = ">——————————<";
      indWrap.appendChild(indInner);
      document.body.appendChild(indWrap);
    }
  }

  // --- Probe box on the right ---
  function ensureBox(){
    if (!box){
      box = document.createElement("div");
      box.id = "ScrollProbe";
      document.body.appendChild(box);
    }
  }

  function now(){ return (performance.now ? performance.now() : Date.now()); }
  function formatMs(ms){ return (ms > 0) ? Math.round(ms) + "ms" : "0ms"; }

  function tick(){
    ensureBox();
    ensureIndicator();

    var t  = now();
    var y  = window.pageYOffset || document.documentElement.scrollTop || 0;
    if (y < 0) y = 0; // ignore rubber-band negatives on iOS
    var dt = Math.max(1, t - lastT);
    var dy = y - lastY;
    var v  = (dy / dt * 1000).toFixed(1); // px/s

    // Move indicator down by current scroll (one direction we care about: down)
    var indY = (y > 0 ? Math.round(y) : 0);
    if (indInner){
      indInner.style.transform = "translate(-50%, " + indY + "px)";
    }
    window.__IndicatorY = indY; // exposed for debugging

    // Existing DrawersController signals (if present)
    var dc  = window.DrawersController || null;
    var acc = dc && typeof dc._accumulatedInput === "number" ? Math.round(dc._accumulatedInput) : "—";
    var fzn = dc && typeof dc._isFrozen === "function" ? dc._isFrozen() : false;
    var blc = dc && typeof dc._blockScroll === "boolean" ? dc._blockScroll : false;
    var anim= dc && typeof dc._isAnimating === "boolean" ? dc._isAnimating : false;
    var dir = dc && typeof dc._scrollDirection === "number" ? (dc._scrollDirection > 0 ? "down" : (dc._scrollDirection < 0 ? "up" : "—")) : "—";
    var last= dc && typeof dc._lastScrollY === "number" ? Math.round(dc._lastScrollY) : "—";
    var sup = dc && typeof dc._suppressIOUntil === "number" ? Math.max(0, Math.round(dc._suppressIOUntil - now())) : 0;
    var frz = dc && typeof dc._freezeUntil === "number" ? Math.max(0, Math.round(dc._freezeUntil  - now())) : 0;
    var thr = (dc && typeof dc._threshold === "function") ? Math.round(dc._threshold()) : "—";

    var lines = [
      "=== Scroll Probe ===",
      "y: " + Math.round(y) + "px",
      "dy: " + Math.round(dy) + "px  (" + v + " px/s)",
      "",
      "Indicator: " + indY + "px",
      "",
      "accumulatedInput: " + acc + (thr !== "—" ? " / thr " + thr : ""),
      "direction: " + dir,
      "lastScrollY: " + last,
      "isAnimating: " + anim,
      "freeze(ms left): " + formatMs(frz),
      "suppressIO(ms): " + formatMs(sup),
      "blockScroll: " + blc
    ];
    box.textContent = lines.join("\n");

    lastY = y; lastT = t;
    requestAnimationFrame(tick);
  }

  if (document.readyState === "loading"){
    document.addEventListener("DOMContentLoaded", function(){ requestAnimationFrame(tick); }, { once:true });
  } else {
    requestAnimationFrame(tick);
  }
})();
</script>

  <!-- Noscript notice to keep UX understandable if JS is disabled -->
  <noscript>
    <style>
      /* Make drawers reasonably readable without JS */
      [data-drawer-content] { height: auto !important; padding: 0 1rem 1.5rem !important; }
      .TabBar { display: none !important; }
    </style>
    <div style="padding:1rem; color:#fff; background:#222;">
      JavaScript is disabled. Sections are expanded for readability, but interactive features are unavailable.
    </div>
  </noscript>
</body>
</html>