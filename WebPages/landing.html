<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Machine Shop Demo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="../Styles/main.css" />
  <link rel="preload" as="video" href="../Assets/Movie_001.mp4" type="video/mp4">
  <link rel="preload" as="video" href="../Assets/Movie_002.mp4" type="video/mp4">
</head>
<body>
  <!-- Header -->
  <header class="Header">
    <h1 class="HeaderTitle">Welcome to Our Machine Shop</h1>
    <p class="HeaderSubtitle">High-precision parts, modern capabilities.</p>
  </header>

  <!-- Progressive TabBar (built by TabBarController) -->
  <div id="TabBar" class="TabBar" role="tablist" aria-label="Sections" aria-hidden="true">
    <div id="TabBarTrack" class="TabBarTrack"></div>
  </div>

  <!-- Main content: Drawer stack -->
  <main class="Container" id="Top">
    <!-- HERO / Intro: video with Skip Intro -->
    <section class="Drawer Drawer--FixedHero" id="Intro" data-drawer>
      <h3
        class="DrawerTitle"
        data-drawer-summary
        tabindex="0"
        role="button"
        aria-expanded="false"
        aria-controls="Intro__content"
      >Intro</h3>

      <div class="DrawerContent DrawerContent--Fill" id="Intro__content" data-drawer-content>
        <div class="VideoWrapper">
          <video
            class="VideoFixed"
            src="../Assets/Movie_001.mp4"
            data-prime="true"
            preload="auto"
            muted
            autoplay
            playsinline
            webkit-playsinline
          ></video>

          <!-- Uses unified programmatic path that opens About, removes hero, then snaps reliably -->
          <button
            class="SkipButton SkipButton--Overlay"
            type="button"
            onclick="window.DrawersController && window.DrawersController.OpenThenCloseAndScroll('About','Intro');"
          >
            Skip Intro
          </button>
        </div>
      </div>
    </section>

    <!-- About -->
    <section class="Drawer" id="About" data-drawer>
      <h3
        class="DrawerTitle"
        data-drawer-summary
        tabindex="0"
        role="button"
        aria-expanded="false"
        aria-controls="About__content"
      >About Us</h3>

      <div class="DrawerContent" id="About__content" data-drawer-content>
        <p>We machine complex parts with tight tolerances and consistent turnaround.</p>
        <p>ISO-style processes, modern CAM, and a quality-first culture.</p>
      </div>
    </section>

    <!-- Shop Tour -->
    <section class="Drawer Drawer--FixedShort" id="Tour" data-drawer>
  <h3 class="DrawerTitle" data-drawer-summary tabindex="0" role="button">Shop Tour</h3>
  <div class="DrawerContent DrawerContent--Fill" data-drawer-content>
    <div class="VideoWrapper">
      <video
        class="VideoFixed"
        src="../Assets/Movie_002.mp4"
        data-prime="true"
        preload="auto"
        muted
        playsinline
        webkit-playsinline
      ></video>
    </div>
  </div>
</section>

    <!-- Capabilities -->
    <section class="Drawer" id="Capabilities" data-drawer>
      <h3
        class="DrawerTitle"
        data-drawer-summary
        tabindex="0"
        role="button"
        aria-expanded="false"
        aria-controls="Capabilities__content"
      >Capabilities</h3>

      <div class="DrawerContent" id="Capabilities__content" data-drawer-content>
        <ul>
          <li>3-axis &amp; 5-axis milling, CNC turning</li>
          <li>Materials: 6061/7075, 304/316, 4140, brass, plastics</li>
          <li>Finishes: anodize II/III, passivate, bead blast</li>
          <li>Inspection: calibrated metrology, first-article docs</li>
        </ul>
      </div>
    </section>

    <!-- Contact -->
    <section class="Drawer" id="Contact" data-drawer>
      <h3
        class="DrawerTitle"
        data-drawer-summary
        tabindex="0"
        role="button"
        aria-expanded="false"
        aria-controls="Contact__content"
      >Contact</h3>

      <div class="DrawerContent" id="Contact__content" data-drawer-content>
        <p>Email: <a href="mailto:info@example.com">info@example.com</a></p>
        <p>Phone: 555-0100</p>
      </div>
    </section>
  </main>

  <!-- Footer -->
  <footer class="Footer">
    <small>© <span id="Year"></span> Acme Precision • Demo</small>
  </footer>

  <!-- Scripts (defer to avoid blocking paint) -->
  <script src="../Scripts/Utilities.js" defer></script>
  <script src="../Scripts/Drawers.js" defer></script>
  <script src="../Scripts/TabBar.js" defer></script>

  <!-- Left debug probe (kept for diagnostics) -->
  <script>
  (function(){
    function probe() {
      var intro = document.getElementById("Intro");
      if (!intro) return;
      var content = intro.querySelector("[data-drawer-content]");
      var video   = intro.querySelector("video");
      var button  = intro.querySelector(".SkipButton--Overlay");
      var cr = content ? content.getBoundingClientRect() : null;
      var vr = video   ? video.getBoundingClientRect()   : null;
      var br = button  ? button.getBoundingClientRect()  : null;
      var txt = [
        "content bottom: " + (cr ? Math.round(cr.bottom) : "—"),
        "video   bottom: " + (vr ? Math.round(vr.bottom) : "—"),
        "button  bottom: " + (br ? Math.round(br.bottom) : "—"),
        "content height: " + (cr ? Math.round(cr.height) : "—"),
        "video   height: " + (vr ? Math.round(vr.height) : "—")
      ].join("\n");
      var box = document.getElementById("DebugProbe");
      if (!box) {
        box = document.createElement("div");
        box.id = "DebugProbe";
        document.body.appendChild(box);
      }
      box.textContent = txt;
    }
    ["load","resize","orientationchange","scroll"].forEach(function(ev){
      window.addEventListener(ev, probe, {passive:true});
    });
    document.addEventListener("loadedmetadata", probe, true);
    document.addEventListener("transitionend", probe, true);
    setInterval(probe, 400);
  })();
  </script>

<!-- Right scroll probe (iOS-robust) -->
<script>
(function(){
  "use strict";

  // Return the best current scrollY and which source it came from
  function getScrollYWithSource(){
    var candidates = [];
    // Window APIs
    if (typeof window.scrollY === "number")      { candidates.push({y: window.scrollY || 0, source: "window.scrollY"}); }
    if (typeof window.pageYOffset === "number")  { candidates.push({y: window.pageYOffset || 0, source: "window.pageYOffset"}); }

    // Document scrolling element + roots
    var se = document.scrollingElement;
    if (se && typeof se.scrollTop === "number")  { candidates.push({y: se.scrollTop || 0, source: "document.scrollingElement.scrollTop"}); }
    var de = document.documentElement;
    if (de && typeof de.scrollTop === "number")  { candidates.push({y: de.scrollTop || 0, source: "document.documentElement.scrollTop"}); }
    var bo = document.body;
    if (bo && typeof bo.scrollTop === "number")  { candidates.push({y: bo.scrollTop || 0, source: "document.body.scrollTop"}); }

    // iOS Safari quirk: sometimes only the visual viewport moves
    if (window.visualViewport && typeof window.visualViewport.pageTop === "number") {
      candidates.push({y: Math.max(0, Math.round(window.visualViewport.pageTop)), source: "visualViewport.pageTop"});
    }

    // Geometry fallback: negative top of the root rect correlates with scroll
    if (de && typeof de.getBoundingClientRect === "function") {
      var rt = de.getBoundingClientRect().top;
      if (isFinite(rt)) {
        candidates.push({y: Math.max(0, Math.round(-rt)), source: "rootRect.top"});
      }
    }

    // Pick the largest y (most browsers keep all in sync; on iOS one may be nonzero)
    var best = { y: 0, source: "none" };
    for (var i = 0; i < candidates.length; i++){
      if (candidates[i].y > best.y) { best = candidates[i]; }
    }
    return best;
  }

  function getNow(){ return (window.performance && performance.now) ? performance.now() : Date.now(); }

  function ensureBox(){
    var box = document.getElementById("ScrollProbe");
    if (!box){
      box = document.createElement("div");
      box.id = "ScrollProbe";
      document.body.appendChild(box);
    }
    return box;
  }

  function getTabBarBottom(){
    var bar = document.getElementById("TabBar");
    if (!bar) return 0;
    var r = bar.getBoundingClientRect();
    return Math.round(r.bottom || 0);
  }

  function readCssVarPx(name){
    var v = getComputedStyle(document.documentElement).getPropertyValue(name).trim();
    var num = parseFloat(v);
    return isFinite(num) ? Math.round(num) : 0;
  }

  // Track last opened drawer id (for snap diagnostics)
  var lastOpenedId = null;
  document.addEventListener("drawer:opened", function(e){
    if (e && e.detail && e.detail.id){ lastOpenedId = e.detail.id; }
  });
  document.addEventListener("DOMContentLoaded", function(){
    var open = document.querySelector(".Drawer.Drawer--Open");
    if (open && open.id) lastOpenedId = open.id;
  });

  var box = null;
  var last = getScrollYWithSource();
  var lastY = last.y;
  var lastT = getNow();

  // Some iOS builds throttle rAF during momentum scroll; force refresh on scroll + visualViewport scroll
  var forceRefresh = false;
  window.addEventListener("scroll", function(){ forceRefresh = true; }, { passive:true });
  if (window.visualViewport && typeof window.visualViewport.addEventListener === "function") {
    window.visualViewport.addEventListener("scroll", function(){ forceRefresh = true; }, { passive:true });
  }

  function tick(){
    box = ensureBox();

    var now    = getNow();
    var best   = getScrollYWithSource();
    var y      = best.y;
    var source = best.source;

    var dt = Math.max(1, now - lastT);
    var dy = y - lastY;
    var v  = (dy / dt * 1000); // px/s

    var dc  = window.DrawersController || null;
    var isAnimating = !!(dc && dc._isAnimating);

    var tabMode   = document.body.classList.contains("Tabs--Visible");
    var barBottom = getTabBarBottom();
    var cssOffset = readCssVarPx("--TabBarOffsetPixels");

    var activeTopDelta = "—";
    if (lastOpenedId){
      var active = document.getElementById(lastOpenedId);
      if (active){
        var title = active.querySelector("[data-drawer-summary]") || active;
        var tr = title.getBoundingClientRect();
        activeTopDelta = Math.round(tr.top - barBottom) + "px";
      }
    }

    var lines = [
      "=== Scroll Probe ===",
      "y: " + Math.round(y) + "px  [" + source + "]",
      "dy: " + Math.round(dy) + "px  (" + v.toFixed(1) + " px/s)",
      "",
      "tabMode: " + tabMode,
      "barBottom: " + barBottom + "px",
      "--TabBarOffsetPixels: " + cssOffset + "px",
      "activeDrawer: " + (lastOpenedId || "—"),
      "active title vs bar: " + activeTopDelta,
      "",
      "isAnimating: " + isAnimating
    ];

    box.textContent = lines.join("\n");
    lastY = y; lastT = now;

    if (forceRefresh){
      forceRefresh = false;
      requestAnimationFrame(tick);
    } else {
      requestAnimationFrame(tick);
    }
  }

  if (document.readyState === "loading"){
    document.addEventListener("DOMContentLoaded", function(){ requestAnimationFrame(tick); });
  } else {
    requestAnimationFrame(tick);
  }
})();
</script>

  <!-- Noscript notice to keep UX understandable if JS is disabled -->
  <noscript>
    <style>
      /* Make drawers reasonably readable without JS */
      [data-drawer-content] { height: auto !important; padding: 0 1rem 1.5rem !important; }
      .TabBar { display: none !important; }
    </style>
    <div style="padding:1rem; color:#fff; background:#222;">
      JavaScript is disabled. Sections are expanded for readability, but interactive features are unavailable.
    </div>
  </noscript>
</body>
</html>